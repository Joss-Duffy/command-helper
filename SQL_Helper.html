<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Help</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }

        .container {
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 40px;
        }

        .dropdown {
            margin-bottom: 20px;
            text-align: center;
        }

        select {
            padding: 10px;
            font-size: 16px;
        }

        .query-display {
            margin-top: 20px;
            background-color: #f4f4f4;
            border-radius: 5px;
            padding: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
            cursor: pointer;
        }

        .description {
            margin-top: 10px;
            font-style: italic;
            color: #555;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-in-out;
            z-index: 1000;
        }

        .show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>SQL Help</h1>

        <div class="dropdown">
            <label for="queryList">Select a query:</label>
            <select id="queryList" onchange="showQuery()">
                <option value="">-- Select a query --</option>
                <option value="createDbUser">Create Database User</option>
                <option value="fixUsersLogContractor">Fix Users Contractors</option>
                <option value="GetActivityDetails">Get Activity Details</option>
                <option value="getDigitalData">Get Digital Data</option>
                <option value="getDigitalWeldData">Get Digital Weld PDF Data</option>
                <option value="insertMissingWfTeams">Insert missing workflow teams</option>
                <option value="resetChecklistToDefault">Reset Checklist to Default</option>
                <option value="resetDigitalChecklist">Reset Digital Checklist</option>
                <option value="ResetUsers">Reset Users</option>
                <option value="testingReset">Reset Users (Testing)</option>

            </select>
        </div>

        <div class="query-display" id="queryDisplay" onclick="copyQuery()">
            Select a query from the dropdown to see the details.
        </div>

        <div class="description" id="queryDescription"></div>

        <div id="notification" class="notification">Copied to clipboard!</div>
    </div>

    <script>
        const queries = {

            "insertMissingWfTeams": `
SELECT t2.*
FROM workflowteam t2
WHERE t2.projectId = 14
  AND t2.teamDescription LIKE '%: copyingTeams%'
  AND NOT EXISTS (
	SELECT 1
	FROM workflowteam t1
	WHERE t1.projectId = 14
	  AND t1.teamDescription = CONCAT(t2.teamNameDisplayValue, ' : teamsThatAreMissing')
  );



INSERT INTO workflowteam (
  projectId, teamName, teamDescription, status, viewOwnLogsOnly,
  teamNameDisplayValue, defaultStage, contractorId,
  insertedAt, insertedById, insertedBy, modifiedProg
)
SELECT
  14,
  teamName,
  CONCAT(teamNameDisplayValue, ' : teamsThatAreMissing'), #teamsThatAreMissing is the teams we want to add to
  status,
  viewOwnLogsOnly,
  teamNameDisplayValue,
  defaultStage,
  contractorId,
  NOW(),
  insertedById,
  insertedBy,
  'createWorkflowTeam'
FROM workflowteam t2
WHERE t2.projectId = 14
  AND t2.teamDescription LIKE '%: copyingTeams%' #copyingTeams is the team we want to copy from
  AND NOT EXISTS (
	SELECT 1
	FROM workflowteam t1
	WHERE t1.projectId = 14
	  AND t1.teamDescription = CONCAT(t2.teamNameDisplayValue, ' : teamsThatAreMissing')
  );`,

            "createDbUser": `
CREATE USER 'eida_db'@'%' IDENTIFIED BY 'EIDA*50*Db)';
GRANT ALL PRIVILEGES ON eida_db.* TO 'eida_db'@'%' WITH GRANT OPTION;
GRANT SUPER ON *.* TO 'eida_db'@'%' IDENTIFIED BY 'EIDA*50*Db)';
SET GLOBAL max_allowed_packet = 20971520;`,

            "resetChecklistToDefault": `
UPDATE trackeractivitydetails
SET digitalDocumentItemId = NULL,
    pdfAvailable = 'N',
    hexValue = NULL,
    checklistStarted = 0,
    completedAt = NULL,
    completedChecklistAt = NULL,
    completedAtId = NULL
WHERE trackeractivitydetailsid = '@trackeractivitydetailsid';`,

            "GetActivityDetails": `
SELECT s.digitalDocumentItemId 
FROM trackeractivitydetails s
WHERE s.activityId = (SELECT a.activityId FROM activity a WHERE a.activityName = ":activityName")
  AND s.equipmentListId = (SELECT e.equipmentListId FROM equipmentlist e WHERE e.tagNo = ":tagNo");`,

            "getDigitalData": `
SELECT fd.fieldName, fd.pageId, f.fieldName, fd.value
FROM dditem i
INNER JOIN ddiitem ii ON ii.documentId = i.id AND ii.deleted = 0
INNER JOIN ddiipage ip ON ip.itemId = ii.id AND ip.deleted = 0
INNER JOIN ddipfield fd ON fd.pageId = ip.id AND fd.deleted = 0
INNER JOIN ddtiflink tf ON tf.id = fd.fieldId AND tf.deleted = 0
INNER JOIN ddtifield f ON f.id = tf.fieldId AND f.deleted = 0
WHERE i.projectId = :projectId
  AND i.id = :digitalDocumentItemId
ORDER BY fd.pageId, f.fieldName;`,

            "getDigitalWeldData": `
SELECT h.documentIdCreatedWeldHistory, h.weldNo AS "Weld Number (1)",
       h.dateWelded AS "Date Welded",
       CONCAT(wr.welderId, ' - ', p.wpsName, ' - ', h.weldType) AS "Welder's ID",
       h.couponNumber AS "Coupon Number",
       h.isAdditional AS "Hand Weld",
       s.pipeSize AS "Pipe Size",
       sp.specificationName AS "Material (2) [Top Value]",
       ma.materialDescription AS "Part Description (3) [Top Value]",
       m.heatNo AS "IMER No's [Top Value]",
       h.firstWeld AS "Exam Type",
       h.qcrAR AS "Accept/Reject [1st]",
       h.qcrDate AS "Inital and Date [Date 1]",
       h.o2MeterReading AS "Inspection Type (4)",
       h.qarAR AS "Accept/Reject [2nd]",
       h.qarDate AS "Accept/Reject [2nd]",
       h.comments AS "Comments"
FROM weldhistory h
INNER JOIN sizeandspecification s ON s.sizeAndSpecificationId = h.sizeAndSpecificationId
INNER JOIN welder wr ON wr.welderGeneratedId = h.welderGeneratedId
INNER JOIN wps p ON p.wpsId = h.wpsId
INNER JOIN specification sp ON sp.specificationId = s.specificationId
INNER JOIN materialcertificate m ON m.materialCertificateId = h.materialCertificateId1
INNER JOIN material ma ON ma.materialId = m.materialId
WHERE h.documentId = 330542
ORDER BY h.weldNo;`,

            "resetDigitalChecklist": `
UPDATE ddipfield AS fd
INNER JOIN ddiipage ip ON ip.id = fd.pageId AND ip.deleted = 0
INNER JOIN ddiitem ii ON ii.id = ip.itemId AND ii.deleted = 0
INNER JOIN dditem i ON i.id = ii.documentId AND i.deleted = 0
SET fd.value = NULL, fd.modifiedById = 1, fd.modifiedAt = NOW()
WHERE i.projectId = 1.? AND i.id = 2.? AND fd.value IS NOT NULL;`,

            "ResetUsers": `
UPDATE USER SET PASSWORD = 'naYUldWRed+UHp50vko+spyWEXr3orvU/4eNt+n126hTycWUajG8gdw5TH01la14';
UPDATE USER SET emailAddress = CONCAT(userId, firstName, lastName, '@eidacentral.com');
UPDATE personnel SET email = CONCAT(personnel.userId, personnel.personName, '@eidacentral.com');
UPDATE USER SET STATUS = "ACTIVE";
UPDATE USER SET policyVersionNumber = 2;
UPDATE USER SET failedLoginAttempts = 0;
UPDATE USER SET dateLastPwChange = NOW();
UPDATE USER SET emailAddress = REPLACE(emailAddress, ' ', '');`,

            "testingReset": `
UPDATE user SET PASSWORD = 'rG6YzeRqlzbWo47LTYglfS56DFbnTLqYjJD6PxGVohBOsd9bHlb5I3oH2vcFH8Nt';
UPDATE user SET dateLastPwChange = NOW();
UPDATE user SET failedLoginAttempts = 0;
update user set \`status\` = 'ACTIVE'
`,

            "fixUsersLogContractor": `
UPDATE document d
INNER JOIN genericlogdocument g ON d.documentId = g.documentId
INNER JOIN userproject p ON (p.userId = g.requestedById AND p.projectId = :projectId)
SET d.contractorId = p.contractorId
WHERE g.projectId = :projectId 
  AND g.requestedById = (
      SELECT su.userId FROM user su WHERE su.emailAddress = ":email"
  )
  AND d.contractorId != p.contractorId;`
        };

        const descriptions = {
            "GetActivityDetails": "Find trackeractivitydetails for a checklist item by activityId and equipmentListId.",
            "getDigitalWeldData": "Returns mapped DWH data for Global Project 6.",
            "createDbUser": "Create a database user with all permissions.",
            "resetDigitalChecklist": "Clears digital checklist data (doesn't reset icon).",
            "resetChecklistToDefault": "Unlinks digital checklist and resets checklist flags.",
            "testingReset": "Use for staging/testing environments."
        };

        function showQuery() {
            const queryList = document.getElementById("queryList").value;
            const queryText = queries[queryList] || "Select a query from the dropdown to see the details.";
            document.getElementById("queryDisplay").textContent = queryText;
            document.getElementById("queryDescription").innerHTML = descriptions[queryList] || "";
            localStorage.setItem('selectedQuery', queryList);
        }

        function copyQuery() {
            const queryText = document.getElementById("queryDisplay").textContent;
            if (queryText && queryText !== "Select a query from the dropdown to see the details.") {
                const tempInput = document.createElement("textarea");
                tempInput.value = queryText;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand("copy");
                document.body.removeChild(tempInput);
                showNotification("Copied to clipboard!");
            } else {
                showNotification("No query selected to copy.");
            }
        }

        function showNotification(message) {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.classList.add("show");
            setTimeout(() => {
                notification.classList.remove("show");
            }, 2000);
        }

        function loadLastSelectedQuery() {
            const lastSelectedQuery = localStorage.getItem("selectedQuery");
            if (lastSelectedQuery) {
                document.getElementById("queryList").value = lastSelectedQuery;
                showQuery();
            }
        }

        window.onload = loadLastSelectedQuery;
    </script>

</body>

</html>